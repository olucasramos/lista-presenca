<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chamada</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>ðŸ“‹ Chamada</h1>
    <div id="data-hoje"></div>
    <div id="lista-funcionarios"></div>
    <button id="btn-salvar" class="btn">ðŸ’¾ Salvar Chamada</button>
    <a href="index.html" class="btn btn-voltar">â¬… Voltar</a>

    <script type="module">
       import { db, ref, get, set, update } from './firebase.js?v=1';

        const listaDiv = document.getElementById("lista-funcionarios");
        const dataHoje = new Date().toLocaleDateString('pt-BR');
        document.getElementById("data-hoje").innerText = `Data: ${dataHoje}`;

        // Buscar funcionÃ¡rios
        get(ref(db, 'funcionarios')).then(snapshot => {
            if (snapshot.exists()) {
                const funcionarios = snapshot.val();
                for (let id in funcionarios) {
                    let f = funcionarios[id];
                    let div = document.createElement("div");
                    div.innerHTML = `
                        <strong>${f.nome}</strong> (${f.tipo})
                        <select id="status-${id}">
                            <option value="presente">Presente</option>
                            <option value="falta">Falta</option>
                        </select>
                        ${f.tipo === 'funcionario' ? 
                        `<label><input type="checkbox" id="atestado-${id}"> Atestado</label>` : ''}
                        <hr>
                    `;
                    listaDiv.appendChild(div);
                }
            } else {
                listaDiv.innerHTML = "<p>Nenhum funcionÃ¡rio cadastrado.</p>";
            }
        });

        document.getElementById("btn-salvar").addEventListener("click", () => {
            get(ref(db, 'funcionarios')).then(snapshot => {
                if (snapshot.exists()) {
                    const funcionarios = snapshot.val();
                    for (let id in funcionarios) {
                        let status = document.getElementById(`status-${id}`).value;
                        let atestado = funcionarios[id].tipo === 'funcionario'
                            ? document.getElementById(`atestado-${id}`).checked
                            : false;

                        set(ref(db, `chamadas/${dataHoje}/${id}`), {
                            status: status,
                            atestado: atestado
                        });
                    }
                    alert("Chamada salva com sucesso!");
                }
            });
        });
    </script>
</body>
</html>
